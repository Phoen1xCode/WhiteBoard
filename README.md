# WhiteBoard

è¿™æ˜¯ä¸€ä¸ªå¯åˆ†äº«ã€å¯å®æ—¶å±•ç¤ºçš„**åœ¨çº¿å›¢é˜Ÿåä½œç™½æ¿**ï¼Œä»¿ç…§ excalidraw çš„ç•Œé¢å’ŒåŠŸèƒ½å¼€å‘ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- å¤šç§ç»˜å›¾å·¥å…·ï¼šè‡ªç”±çº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ã€ç›´çº¿ç­‰
- å®æ—¶åä½œï¼šå¤šäººåŒæ—¶ç¼–è¾‘ï¼Œå®æ—¶åŒæ­¥
- ä¸€é”®åˆ†äº«ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œæ”¯æŒå¤šäººæŸ¥çœ‹
- Monorepo æ¶æ„ï¼šå‰åç«¯ä»£ç ç»Ÿä¸€ç®¡ç†

## æŠ€æœ¯æ ˆ

### å‰ç«¯

- æ¡†æ¶ï¼šReact + TypeScript + Vite
- ç»˜å›¾å¼•æ“ï¼šKonva.js + react-konva
- çŠ¶æ€ç®¡ç†ï¼šZustand + Immer
- æ ¡éªŒåè®®ï¼šzod
- å¿«æ·é”®ä¸æ‰‹åŠ¿ï¼šreact-hotkeys-hook + Pointer Events
- UI: Tailwind CSS + Lucide Icon

### åç«¯

- æ¡†æ¶ï¼šNode.js + Koa
- å®æ—¶åä½œï¼šSocket.IO
- æ•°æ®åº“ï¼šPostgreSQL + Prisma

### å·¥ç¨‹/è¿ç»´

- åŒ…ç®¡ç†å™¨ï¼šyarn
- ä»£ç è´¨é‡ï¼šESLint + Prettier
- éƒ¨ç½²ï¼šDocker éƒ¨ç½²

## åŠŸèƒ½åˆ—è¡¨

- [x] åŸºç¡€æ¶æ„æ­å»ºï¼ˆMonorepo + Yarn Workspacesï¼‰
- [x] è‡ªç”±çº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ã€ç›´çº¿ç»˜åˆ¶å·¥å…·
- [x] å®æ—¶æ“ä½œåŒæ­¥ï¼ˆSocket.IOï¼‰
- [x] ç™½æ¿æ•°æ®æŒä¹…åŒ–ï¼ˆPostgreSQLï¼‰
- [x] åŸºç¡€ REST APIï¼ˆåˆ›å»º/è·å–ç™½æ¿ï¼‰
- [x] é¢œè‰²é€‰æ‹©å™¨ã€çº¿æ¡ç²—ç»†è°ƒæ•´
- [x] å®çº¿/è™šçº¿æ ·å¼åˆ‡æ¢
- [x] å…ƒç´ é€‰ä¸­ã€ç¼–è¾‘ã€åˆ é™¤
- [x] å±æ€§é¢æ¿ï¼ˆPropertyPanelï¼‰
- [x] å…ƒç´ æ‹–åŠ¨å’Œå˜æ¢
- [x] é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆå·¥å…·åˆ‡æ¢ã€åˆ é™¤ã€Undo/Redoï¼‰
- [x] Undo/Redo åŠŸèƒ½
- [x] ç”¨æˆ·å…‰æ ‡å®æ—¶æ˜¾ç¤º
- [x] æ©¡çš®æ“¦å·¥å…·
- [x] åˆ†äº«é“¾æ¥å¤åˆ¶åŠŸèƒ½
- [x] è¿æ¥çŠ¶æ€æ˜¾ç¤º
- [x] é¦–é¡µç™½æ¿åˆ—è¡¨ç®¡ç†
- [x] Docker éƒ¨ç½²é…ç½®

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js >= 18
- Yarn >= 1.22
- PostgreSQL >= 14

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**

```bash
git clone https://github.com/Phoen1xCode/WhiteBoard.git
cd WhiteBoard
```

2. **å®‰è£…ä¾èµ–**

```bash
yarn install
```

3. **é…ç½®æ•°æ®åº“**

åˆ›å»º PostgreSQL æ•°æ®åº“ï¼Œç„¶åé…ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .env æ–‡ä»¶
DATABASE_URL="postgresql://user:password@localhost:5432/whiteboard"
```

4. **è¿è¡Œæ•°æ®åº“è¿ç§»**

```bash
cd apps/server
yarn prisma:generate
yarn prisma:migrate
cd ../..
```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼š

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯ (é»˜è®¤ç«¯å£ 3000)
cd apps/server
yarn dev

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯ (é»˜è®¤ç«¯å£ 5173)
cd apps/web
yarn dev
```

6. **è®¿é—®åº”ç”¨**

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173

## é¡¹ç›®ç»“æ„

```
WhiteBoard/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                      # å‰ç«¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # React ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ board/        # ç™½æ¿ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ style/        # æ ·å¼æ§åˆ¶ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ui/           # é€šç”¨ UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ store/            # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ styles/           # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ server/                   # åç«¯åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚       â”‚   â”œâ”€â”€ routes/           # è·¯ç”±å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ ws/               # WebSocket å¤„ç†
â”‚       â”‚   â””â”€â”€ prisma/           # Prisma å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ prisma/
â”‚       â”‚   â”œâ”€â”€ schema.prisma     # æ•°æ®åº“æ¨¡å‹
â”‚       â”‚   â””â”€â”€ migrations/       # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/                   # å…±äº«ç±»å‹å’Œå·¥å…·
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ types/            # TypeScript ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docker/                       # Docker éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â””â”€â”€ entrypoint.sh
â”‚
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ package.json                  # æ ¹é…ç½®
```

## æ¶æ„è®¾è®¡

### å®æ—¶åä½œåŸç†

æœ¬é¡¹ç›®é‡‡ç”¨ **Operation-based Synchronization** å®ç°å®æ—¶åä½œï¼š

1. **åˆå§‹åŒæ­¥**ï¼šå®¢æˆ·ç«¯è¿æ¥æ—¶ä»æ•°æ®åº“åŠ è½½ç™½æ¿å¿«ç…§
2. **æ“ä½œæµå¼åŒæ­¥**ï¼šæ‰€æœ‰ç¼–è¾‘æ“ä½œé€šè¿‡ Socket.IO å®æ—¶å¹¿æ’­
3. **ä¹è§‚æ›´æ–°**ï¼šæœ¬åœ°æ“ä½œç«‹å³åº”ç”¨ï¼Œæ— éœ€ç­‰å¾…æœåŠ¡å™¨å“åº”

### æ“ä½œç±»å‹

æ‰€æœ‰ç™½æ¿ä¿®æ”¹é€šè¿‡ç»Ÿä¸€çš„ `WhiteBoardOperation` ç±»å‹ï¼š

- `add` - æ·»åŠ æ–°å…ƒç´ 
- `update` - ä¿®æ”¹ç°æœ‰å…ƒç´ 
- `delete` - åˆ é™¤å…ƒç´ 
- `clear` - æ¸…ç©ºç”»æ¿

## ğŸ”§ å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
yarn install

# å‰ç«¯å¼€å‘
cd apps/web && yarn dev

# åç«¯å¼€å‘
cd apps/server && yarn dev

# Prisma ç›¸å…³
cd apps/server
yarn prisma:generate   # ç”Ÿæˆ Prisma Client
yarn prisma:migrate    # è¿è¡Œæ•°æ®åº“è¿ç§»
```

## Docker éƒ¨ç½²

### å‰ç½®è¦æ±‚

- Docker >= 20.10
- Docker Compose >= 2.0

### éƒ¨ç½²å‘½ä»¤

```bash
# è¿›å…¥ docker ç›®å½•å¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
cd docker && docker compose up -d --build
```

### è¯¦ç»†éƒ¨ç½²æ­¥éª¤

1. **é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰**

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp docker/.env.docker.example docker/.env.docker

# ç¼–è¾‘é…ç½®ï¼ˆå¯é€‰ï¼Œé»˜è®¤é…ç½®å¯ç›´æ¥ä½¿ç”¨ï¼‰
vim docker/.env.docker
```

2. **æ„å»ºå¹¶å¯åŠ¨æœåŠ¡**

```bash
# è¿›å…¥ docker ç›®å½•
cd docker

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼‰
docker compose --env-file .env.docker up -d --build

# æˆ–ç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨
docker compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs -f server
```

### å¸¸ç”¨ Docker å‘½ä»¤

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
cd docker && docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
cd docker && docker-compose down -v

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
cd docker && docker-compose up -d --build

# ä»…é‡å¯æŸä¸ªæœåŠ¡
cd docker && docker-compose restart server
```

### Docker æœåŠ¡è¯´æ˜

| æœåŠ¡     | ç«¯å£ | è¯´æ˜                 |
| -------- | ---- | -------------------- |
| web      | 80   | å‰ç«¯ Nginx æœåŠ¡      |
| server   | 3000 | åç«¯ API + WebSocket |
| postgres | 5432 | PostgreSQL æ•°æ®åº“    |

### Docker æ–‡ä»¶ç»“æ„

```
docker/
â”œâ”€â”€ Dockerfile           # å¤šé˜¶æ®µæ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml   # æœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ nginx.conf           # Nginx é…ç½®
â”œâ”€â”€ entrypoint.sh        # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬ï¼ˆå«æ•°æ®åº“è¿ç§»ï¼‰
â””â”€â”€ .env.docker.example  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

## âŒ¨ï¸ é”®ç›˜å¿«æ·é”®

| å¿«æ·é”®                   | åŠŸèƒ½             |
| ------------------------ | ---------------- |
| `P`                      | åˆ‡æ¢åˆ°ç”»ç¬”å·¥å…·   |
| `R`                      | åˆ‡æ¢åˆ°çŸ©å½¢å·¥å…·   |
| `O`                      | åˆ‡æ¢åˆ°åœ†å½¢å·¥å…·   |
| `L`                      | åˆ‡æ¢åˆ°ç›´çº¿å·¥å…·   |
| `E`                      | åˆ‡æ¢åˆ°æ©¡çš®æ“¦å·¥å…· |
| `Delete` / `Backspace`   | åˆ é™¤é€‰ä¸­å…ƒç´      |
| `Ctrl+Z` / `Cmd+Z`       | æ’¤é”€             |
| `Ctrl+Y` / `Cmd+Shift+Z` | é‡åš             |
| `Escape`                 | å–æ¶ˆé€‰ä¸­         |

## ğŸ‘¥ ä½œè€…

[@Phoen1xCode](https://github.com/Phoen1xCode)
